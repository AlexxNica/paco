<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script language="javascript" type="text/javascript" src="file:///android_asset/jquery.js"></script>
    <script language="javascript" type="text/javascript" src="jquery.flot.js"></script>
    <script language="javascript" type="text/javascript">
      $(document).ready(function() {
          var expXdata = window.env.getValue("expXdata");
          var expYdata = window.env.getValue("expYdata");
          var chosenVarXId = window.env.getValue("chosenVarX");
          var chosenVarYId = window.env.getValue("chosenVarY");                              
          expXdata = eval('('+ expXdata + ')');
          expYdata = eval('('+ expYdata + ')');
          chosenVarXId = parseInt(chosenVarXId);
          chosenVarYId = parseInt(chosenVarYId);
          
          if (!expXdata) {
             alert("No DataX");
             return;
          } 
          
          if (!expYdata) {
             alert("No DataY");
             return;
          }
                          
         function getData(expdata, chosenVarId){
            var latestEvent = expdata[0];    
            var responses = latestEvent.responses;
            for ( var i = 0; i < responses.length; i++) {
              var response = responses[i];
              if (response["inputId"] == chosenVarId){
                if (response.answer == null || response.answer.length == 0) {
                    response.answer = "No Answer";
                }
                if (response["responseType"] == "photo" || response["responseType"] == "location" || response["responseType"] == "open text") {
                  alert("Sorry, we do not show any more relationships involving " + response["responseType"] + "s past what you have seen in trends and raw data.");
                  return; 
                }     
              }
            }
            
            expdata = expdata.sort(function(a,b) {
            return a.responseTime - b.responseTime;});
            
            var data = [];
            
            var label = null;
            var sampleAnswer;
            var foundAMatch = false;
            for (var j = 0; j < expdata.length; j++) {
              if (foundAMatch) {
                break;
              }  
              for (var i = 0; i < expdata[j].responses.length; i++) {  
                var response = expdata[j].responses[i];
                if (response.inputId == chosenVarId) {   
                  foundAMatch = true;
                  label = response.prompt;
                  sampleAnswer = response.answer;
                }
              }
            }  
            
            
            
            for (var j = 0; j < expdata.length; j++) {
              var responses = expdata[j].responses;
              for (var r = 0; r < responses.length; r++) {
                if (responses[r].inputId == chosenVarId) {
                  if (!responses[r].answer) {
                    continue;
                  }  
                  data.push([expdata[j].responseTime, responses[r].answer]);
                }
              }
            }
            return [data, label]
         }
          
        var xData; var xLabel; var yData; var yLabel;
        
        [xData, xLabel] = getData(expXdata, chosenVarXId);
        [yData, yLabel] = getData(expYdata, chosenVarYId); 
        
        $("#charttitle").html("<h2>" + xLabel+ " vs. " + yLabel + "</h2>");
        $.plot($("#placeholder"),
            [{label : xLabel, data : xData, lines: { show: true }},
             {label : yLabel, data : yData, lines: { show: true }}
             ],
             {legend: {container: null, backgroundOpacity: 0.5}, xaxis: { mode: "time" }}
             );
    });     
 </script>
 </head>

<body style='text-align: center; color: #4272db;'>
    <div id="charttitle"> 
    <h1>Chart</h1></div>
    
  <div id="placeholder" style="width:300px;height:150px;"></div>

</body>

</html>