<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script language="javascript" type="text/javascript" src="file:///android_asset/jquery-1.5.1.min.js"></script>
    <script language="javascript" type="text/javascript" src="jquery.flot.min.js"></script>
    <script language="javascript" type="text/javascript">
      $(document).ready(function() {
          var expdata = window.env.getValue("experimentalData");
          var chosenVarXId = window.env.getValue("chosenVarX");
          var chosenVarYId = window.env.getValue("chosenVarY");                              
          expdata = eval('('+ expdata + ')');
          chosenVarXId = parseInt(chosenVarXId);
          chosenVarYId = parseInt(chosenVarYId);
          
          if (!expdata) {
             alert("No Data");
             return;
          } 
                          
          var responsesHtml = ""; 
          
          var latestEvent = expdata[0];    
          var responses = latestEvent.responses;
          for ( var i = 0; i < responses.length; i++) {
            var response = responses[i];
            if (response["inputId"] == chosenVarXId || response["inputId"] == chosenVarYId){
              if (response.answer == null || response.answer.length == 0) {
                  response.answer = "No Answer";
              }
              if (response["responseType"] == "photo" || response["responseType"] == "location" || response["responseType"] == "open text") {
                alert("Sorry, we do not show any more relationships involving " + response["responseType"] + "s past what you have seen in trends and raw data.");
                return; 
              }     
            }
          }
          
          expdata = expdata.sort(function(a,b) {
          return a.responseTime - b.responseTime;});
          
          var xData = []; var yData = []; var dates;
          
          var xLabel = null; var xLabel = null; var chartTitle = null;
          var sampleAnswer;
          var foundXMatch = false; var foundYMatch = false;
          for (var j = 0; j < expdata.length; j++) {
            if (foundXMatch && foundYMatch) {
              chartTitle = xLabel + "\r vs. \r" + yLabel;
              break;
            }  
            for (var i = 0; i < expdata[j].responses.length; i++) {  
              var response = expdata[j].responses[i];
              if (response.inputId == chosenVarXId) {   
                foundXMatch = true;
                xLabel = response.prompt;
                sampleAnswer = response.answer;
              }
              if (response.inputId == chosenVarYId) {   
                foundYMatch = true;
                yLabel = response.prompt;
                sampleAnswer = response.answer;
              }
            }
          }  
          
          
          
          for (var j = 0; j < expdata.length; j++) {
            var responses = expdata[j].responses;
            for (var r = 0; r < responses.length; r++) {
              if (responses[r].inputId == chosenVarXId) {
                if (!responses[r].answer) {
                  continue;
                }  
                xData.push([expdata[j].responseTime, responses[r].answer]);
              } else if (responses[r].inputId == chosenVarYId) {
                if (!responses[r].answer) {
                  continue;
                }  
                yData.push([expdata[j].responseTime, responses[r].answer+""]);
              }
            }
          }
          $("#charttitle").html("<h2>" + chartTitle + "</h2>");
          $.plot($("#placeholder"),
              [{label : xLabel, data : xData, lines: { show: true }},
               {label : yLabel, data : yData, lines: { show: true }}
               ],
               {legend: {container: null, backgroundOpacity: 0.5}, xaxis: { mode: "time" }}
               );
               
          alert('here');
    });     
 </script>
 </head>

<body style='text-align: center; color: #4272db;'>
    <div id="charttitle"> 
    <h1>Chart</h1></div>
    
  <div id="placeholder" style="width:300px;height:150px;"></div>

</body>

</html>